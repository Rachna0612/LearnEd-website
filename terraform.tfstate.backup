{
  "version": 4,
  "terraform_version": "1.12.2",
  "serial": 120,
  "lineage": "4d0c3ded-cc4a-8ecf-08ac-f7cf8021dde9",
  "outputs": {
    "Nagios_public_ip": {
      "value": "54.167.113.28",
      "type": "string"
    },
    "travel-website_public_ip": {
      "value": "3.88.63.251",
      "type": "string"
    },
    "website_url": {
      "value": "http://3.88.63.251",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "aws_ami",
      "name": "amazon_linux",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allow_unsafe_filter": null,
            "architecture": "x86_64",
            "arn": "arn:aws:ec2:us-east-1::image/ami-06dd5c911c0d8dcdc",
            "block_device_mappings": [
              {
                "device_name": "/dev/xvda",
                "ebs": {
                  "delete_on_termination": "true",
                  "encrypted": "false",
                  "iops": "0",
                  "snapshot_id": "snap-06ff35e134cdd7137",
                  "throughput": "0",
                  "volume_initialization_rate": "0",
                  "volume_size": "8",
                  "volume_type": "gp2"
                },
                "no_device": "",
                "virtual_name": ""
              }
            ],
            "boot_mode": "",
            "creation_date": "2025-11-04T21:26:43.000Z",
            "deprecation_time": "2026-02-02T00:00:00.000Z",
            "description": "Amazon Linux 2 AMI 2.0.20251105.0 x86_64 HVM gp2",
            "ena_support": true,
            "executable_users": null,
            "filter": [
              {
                "name": "name",
                "values": [
                  "amzn2-ami-hvm-*-x86_64-gp2"
                ]
              }
            ],
            "hypervisor": "xen",
            "id": "",
            "image_id": "",
            "image_location": "amazon/amzn2-ami-hvm-2.0.20251105.0-x86_64-gp2",
            "image_owner_alias": "amazon",
            "image_type": "machine",
            "imds_support": "",
            "include_deprecated": false,
            "kernel_id": "",
            "last_launched_time": "",
            "most_recent": true,
            "name": "amzn2-ami-hvm-2.0.20251105.0-x86_64-gp2",
            "name_regex": null,
            "owner_id": "137112412989",
            "owners": [
              "amazon"
            ],
            "platform": "",
            "platform_details": "Linux/UNIX",
            "product_codes": [],
            "public": true,
            "ramdisk_id": "",
            "region": "us-east-1",
            "root_device_name": "/dev/xvda",
            "root_device_type": "ebs",
            "root_snapshot_id": "snap-06ff35e134cdd7137",
            "sriov_net_support": "simple",
            "state": "available",
            "state_reason": {
              "code": "UNSET",
              "message": "UNSET"
            },
            "tags": {},
            "timeouts": null,
            "tpm_support": "",
            "uefi_data": null,
            "usage_operation": "RunInstances",
            "virtualization_type": "hvm"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_instance",
      "name": "nagios_instance",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "ami": "",
            "arn": "",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1c",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_options": [
              {
                "amd_sev_snp": "",
                "core_count": 1,
                "threads_per_core": 1
              }
            ],
            "credit_specification": [
              {
                "cpu_credits": "standard"
              }
            ],
            "disable_api_stop": false,
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enable_primary_ipv6": null,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "force_destroy": false,
            "get_password_data": false,
            "hibernation": false,
            "host_id": "",
            "host_resource_group_arn": null,
            "iam_instance_profile": "",
            "id": "i-0691a6d33847599e7",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_lifecycle": "",
            "instance_market_options": [],
            "instance_state": "running",
            "instance_type": "t2.micro",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "travel-website",
            "launch_template": [],
            "maintenance_options": [
              {
                "auto_recovery": "default"
              }
            ],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_protocol_ipv6": "disabled",
                "http_put_response_hop_limit": 1,
                "http_tokens": "optional",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_group_id": "",
            "placement_partition_number": 0,
            "primary_network_interface": [
              {
                "delete_on_termination": true,
                "network_interface_id": "eni-0d18deea2170576d2"
              }
            ],
            "primary_network_interface_id": "eni-0d18deea2170576d2",
            "private_dns": "ip-172-31-31-79.ec2.internal",
            "private_dns_name_options": [
              {
                "enable_resource_name_dns_a_record": false,
                "enable_resource_name_dns_aaaa_record": false,
                "hostname_type": "ip-name"
              }
            ],
            "private_ip": "",
            "public_dns": "ec2-54-167-113-28.compute-1.amazonaws.com",
            "public_ip": "54.167.113.28",
            "region": "us-east-1",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/xvda",
                "encrypted": false,
                "iops": 100,
                "kms_key_id": "",
                "tags": {},
                "tags_all": {},
                "throughput": 0,
                "volume_id": "vol-066f73d5ccf0e2c70",
                "volume_size": 8,
                "volume_type": "gp2"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [
              "travel-website_sg"
            ],
            "source_dest_check": true,
            "spot_instance_request_id": "",
            "subnet_id": "subnet-0ae8d4963b038a5b0",
            "tags": {
              "Name": "Nagios-Monitor"
            },
            "tags_all": {
              "Name": "Nagios-Monitor"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "              #!/bin/bash\r\n              sudo yum update -y\r\n              sudo yum install -y httpd php gcc glibc glibc-common wget unzip httpd-tools gd gd-devel openssl-devel make gettext autoconf net-snmp net-snmp-utils epel-release perl-Net-SNMP\r\n\r\n              sudo useradd -m nagios\r\n              sudo groupadd nagcmd\r\n              sudo usermod -a -G nagcmd nagios\r\n              sudo usermod -a -G nagcmd apache\r\n\r\n              cd /tmp\r\n              wget -q https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.4.10.tar.gz\r\n              tar -xzf nagios-4.4.10.tar.gz\r\n              cd nagios-4.4.10\r\n              ./configure --with-command-group=nagcmd --with-httpd-conf=/etc/httpd/conf.d\r\n              make all\r\n              sudo make install\r\n              sudo make install-init\r\n              sudo make install-config\r\n              sudo make install-commandmode\r\n              sudo make install-webconf\r\n\r\n              cd /tmp\r\n              wget -q https://nagios-plugins.org/download/nagios-plugins-2.3.3.tar.gz\r\n              tar -xzf nagios-plugins-2.3.3.tar.gz\r\n              cd nagios-plugins-2.3.3\r\n              ./configure --with-nagios-user=nagios --with-nagios-group=nagios\r\n              make\r\n              sudo make install\r\n\r\n              sudo htpasswd -cb /usr/local/nagios/etc/htpasswd.users nagiosadmin nagios123\r\n\r\n              # Wait for travel-website instance to be ready\r\n              echo \"Waiting for travel-website instance to be ready...\"\r\n              sleep 90\r\n\r\n              # travel-website instance IP (injected from Terraform)\r\n              travel-website_IP=\"172.31.27.216\"\r\n              \r\n              # If private IP is not available, use public IP as fallback\r\n              if [ -z \"$travel-website_IP\" ] || [ \"$travel-website_IP\" == \"\" ]; then\r\n                travel-website_IP=\"3.88.63.251\"\r\n              fi\r\n              \r\n              echo \"Configuring Nagios to monitor travel-website website at IP: $travel-website_IP\"\r\n\r\n              # Ensure objects directory exists and has correct permissions\r\n              sudo mkdir -p /usr/local/nagios/etc/objects\r\n              sudo chown -R nagios:nagios /usr/local/nagios/etc/objects\r\n\r\n              # Create Nagios host definition for travel-website website - an education website\r\n              # Use a simpler approach without template dependencies\r\n              sudo tee /usr/local/nagios/etc/objects/travel-website_host.cfg \u003e /dev/null \u003c\u003cNAGIOS_HOST\r\ndefine host {\r\n    host_name               travel-website-website\r\n    alias                   travel-website Website - an education website\r\n    address                 $travel-website_IP\r\n    check_command           check-host-alive\r\n    check_interval          5\r\n    retry_interval          1\r\n    max_check_attempts      3\r\n    check_period            24x7\r\n    notification_interval   30\r\n    notification_period     24x7\r\n    notifications_enabled   1\r\n    contact_groups          +admins\r\n}\r\n\r\ndefine service {\r\n    host_name               travel-website-website\r\n    service_description     travel-website Website HTTP Check\r\n    check_command           check_http\r\n    check_interval          5\r\n    retry_interval          1\r\n    max_check_attempts      3\r\n    check_period            24x7\r\n    notification_interval   30\r\n    notification_period     24x7\r\n    notifications_enabled   1\r\n    contact_groups          +admins\r\n}\r\n\r\ndefine service {\r\n    host_name               travel-website-website\r\n    service_description     travel-website Website Ping\r\n    check_command           check_ping!100.0,20%!500.0,60%\r\n    check_interval          5\r\n    retry_interval          1\r\n    max_check_attempts      3\r\n    check_period            24x7\r\n    notification_interval   30\r\n    notification_period     24x7\r\n    notifications_enabled   1\r\n    contact_groups          +admins\r\n}\r\nNAGIOS_HOST\r\n\r\n              # Set proper permissions\r\n              sudo chown nagios:nagios /usr/local/nagios/etc/objects/travel-website_host.cfg\r\n              sudo chmod 644 /usr/local/nagios/etc/objects/travel-website_host.cfg\r\n\r\n              # Update nagios.cfg to include the new host definition\r\n              if ! grep -q \"travel-website_host.cfg\" /usr/local/nagios/etc/nagios.cfg; then\r\n                echo \"cfg_file=/usr/local/nagios/etc/objects/travel-website_host.cfg\" | sudo tee -a /usr/local/nagios/etc/nagios.cfg\r\n              fi\r\n\r\n              # Verify the IP was set correctly\r\n              echo \"travel-website IP configured: $travel-website_IP\"\r\n              if [ -z \"$travel-website_IP\" ] || [ \"$travel-website_IP\" == \"\" ]; then\r\n                echo \"ERROR: travel-website IP is empty! Cannot configure Nagios.\"\r\n                exit 1\r\n              fi\r\n\r\n\r\n              sudo systemctl enable httpd\r\n              sudo systemctl start httpd\r\n\r\n              sudo tee /etc/systemd/system/nagios.service \u003e /dev/null \u003c\u003c'SERVICE'\r\n[Unit]\r\nDescription=Nagios\r\nAfter=network.target\r\n\r\n[Service]\r\nType=simple\r\nUser=nagios\r\nGroup=nagios\r\nExecStart=/usr/local/nagios/bin/nagios /usr/local/nagios/etc/nagios.cfg\r\nRestart=always\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\nSERVICE\r\n\r\n              sudo systemctl daemon-reload\r\n              sudo systemctl enable nagios\r\n              \r\n              # Wait a moment for file system to settle\r\n              sleep 5\r\n              \r\n              # Verify Nagios configuration before starting\r\n              echo \"Verifying Nagios configuration...\"\r\n              CONFIG_CHECK=$(sudo /usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg 2\u003e\u00261)\r\n              CONFIG_STATUS=$?\r\n              \r\n              if [ $CONFIG_STATUS -ne 0 ]; then\r\n                echo \"Nagios configuration errors found:\"\r\n                echo \"$CONFIG_CHECK\"\r\n                echo \"Attempting to fix common issues...\"\r\n                \r\n                # Try to fix missing contact groups by ensuring contacts.cfg exists\r\n                if [ ! -f /usr/local/nagios/etc/objects/contacts.cfg ]; then\r\n                  echo \"Creating basic contacts.cfg...\"\r\n                  sudo tee /usr/local/nagios/etc/objects/contacts.cfg \u003e /dev/null \u003c\u003cCONTACTS\r\ndefine contact {\r\n    contact_name                    nagiosadmin\r\n    alias                           Nagios Admin\r\n    service_notification_period     24x7\r\n    host_notification_period        24x7\r\n    service_notification_options    w,u,c,r\r\n    host_notification_options       d,u,r\r\n    service_notification_commands   notify-service-by-email\r\n    host_notification_commands      notify-host-by-email\r\n    email                           nagios@localhost\r\n}\r\n\r\ndefine contactgroup {\r\n    contactgroup_name       admins\r\n    alias                   Nagios Administrators\r\n    members                 nagiosadmin\r\n}\r\nCONTACTS\r\n                  sudo chown nagios:nagios /usr/local/nagios/etc/objects/contacts.cfg\r\n                fi\r\n                \r\n                # Verify again\r\n                sudo /usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg\r\n              else\r\n                echo \"Nagios configuration is valid!\"\r\n              fi\r\n              \r\n              # Start Nagios\r\n              sudo systemctl start nagios\r\n              \r\n              # Check if Nagios started successfully\r\n              sleep 3\r\n              if sudo systemctl is-active --quiet nagios; then\r\n                echo \"Nagios started successfully!\"\r\n              else\r\n                echo \"Nagios failed to start. Checking logs...\"\r\n                sudo journalctl -u nagios -n 50 --no-pager\r\n              fi\r\n",
            "user_data_base64": null,
            "user_data_replace_on_change": false,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-0426c5414a2735059"
            ]
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "",
            "id": "7",
            "region": "us-east-1"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwicmVhZCI6OTAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMiJ9",
          "dependencies": [
            "aws_instance.travel-website_instance",
            "aws_security_group.travel-website_sg",
            "data.aws_ami.amazon_linux"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_instance",
      "name": "travel-website_instance",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "ami": "",
            "arn": "",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1c",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_options": [
              {
                "amd_sev_snp": "",
                "core_count": 1,
                "threads_per_core": 1
              }
            ],
            "credit_specification": [
              {
                "cpu_credits": "standard"
              }
            ],
            "disable_api_stop": false,
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enable_primary_ipv6": null,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "force_destroy": false,
            "get_password_data": false,
            "hibernation": false,
            "host_id": "",
            "host_resource_group_arn": null,
            "iam_instance_profile": "",
            "id": "i-006f18a9fa95376de",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_lifecycle": "",
            "instance_market_options": [],
            "instance_state": "running",
            "instance_type": "t2.micro",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "travel-website",
            "launch_template": [],
            "maintenance_options": [
              {
                "auto_recovery": "default"
              }
            ],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_protocol_ipv6": "disabled",
                "http_put_response_hop_limit": 1,
                "http_tokens": "optional",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_group_id": "",
            "placement_partition_number": 0,
            "primary_network_interface": [
              {
                "delete_on_termination": true,
                "network_interface_id": "eni-0ee9799d61da0620f"
              }
            ],
            "primary_network_interface_id": "eni-0ee9799d61da0620f",
            "private_dns": "ip-172-31-27-216.ec2.internal",
            "private_dns_name_options": [
              {
                "enable_resource_name_dns_a_record": false,
                "enable_resource_name_dns_aaaa_record": false,
                "hostname_type": "ip-name"
              }
            ],
            "private_ip": "172.31.27.216",
            "public_dns": "ec2-3-88-63-251.compute-1.amazonaws.com",
            "public_ip": "3.88.63.251",
            "region": "us-east-1",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/xvda",
                "encrypted": false,
                "iops": 100,
                "kms_key_id": "",
                "tags": {},
                "tags_all": {},
                "throughput": 0,
                "volume_id": "vol-0f7693912f47ad7cf",
                "volume_size": 8,
                "volume_type": "gp2"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [
              "travel-website_sg"
            ],
            "source_dest_check": true,
            "spot_instance_request_id": "",
            "subnet_id": "subnet-0ae8d4963b038a5b0",
            "tags": {
              "Name": "travel-website-Server"
            },
            "tags_all": {
              "Name": "travel-website-Server"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "#!/bin/bash\r\nsudo yum update -y\r\nsudo amazon-linux-extras install nginx1 -y\r\nsudo systemctl enable nginx\r\nsudo systemctl start nginx\r\n\r\n# Install Git\r\nsudo yum install -y git\r\n\r\n# Clone your travel-website project from GitHub - an travel website\r\ncd /tmp\r\ngit clone https://github.com/Abhaymehta1424/travel_devops.git\r\n              \r\n# Copy website files to Nginx web root\r\nsudo cp -r travel-website-website/* /usr/share/nginx/html/\r\n\r\n# Restart Nginx\r\nsudo systemctl restart nginx\r\n",
            "user_data_base64": null,
            "user_data_replace_on_change": false,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-0426c5414a2735059"
            ]
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "881490100253",
            "id": "i-006f18a9fa95376de",
            "region": "us-east-1"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwicmVhZCI6OTAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMiJ9",
          "dependencies": [
            "aws_security_group.travel-website_sg",
            "data.aws_ami.amazon_linux"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "travel-website_sg",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:881490100253:security-group/sg-0426c5414a2735059",
            "description": "Allow SSH, HTTP, and Nagios access",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-0426c5414a2735059",
            "ingress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "Allow HTTP",
                "from_port": 80,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 80
              },
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "Allow ICMP (ping) for host checks",
                "from_port": -1,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "icmp",
                "security_groups": [],
                "self": false,
                "to_port": -1
              },
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "Allow Nagios Web UI (port 8080)",
                "from_port": 8080,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 8080
              },
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "Allow SSH",
                "from_port": 22,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 22
              }
            ],
            "name": "travel-website_sg",
            "name_prefix": "",
            "owner_id": "881490100253",
            "region": "us-east-1",
            "revoke_rules_on_delete": false,
            "tags": {
              "Name": "travel-website Security Group"
            },
            "tags_all": {
              "Name": "travel-website Security Group"
            },
            "timeouts": null,
            "vpc_id": "vpc-0ab7ffa52ea87d2b8"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "881490100253",
            "id": "sg-0426c5414a2735059",
            "region": "us-east-1"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="
        }
      ]
    }
  ],
  "check_results": null
}
